<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to BioTIMEr • BioTIMEr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="introduction_files/libs/quarto-html/popper.min.js"></script><script src="introduction_files/libs/quarto-html/tippy.umd.min.js"></script><link href="introduction_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="introduction_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to BioTIMEr">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BioTIMEr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/introduction.html">Introduction to BioTIMEr</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bioTIMEHub/BioTIMEr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to BioTIMEr</h1>

      <p class="author">Inês S. Martins</p>
      <p class="date">2026-01-30</p>

      <small class="dont-index">Source: <a href="https://github.com/bioTIMEHub/BioTIMEr/blob/main/vignettes/introduction.qmd" class="external-link"><code>vignettes/introduction.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <p>The <code>BioTIMEr</code> package provides tools designed to interact with the BioTIME database, which contains assemblage time series from multiple habitats and for multiple taxa (Dornelas et al 2018, 2024). The functions provided include the BioTIME recommended methods for preparing time series data (gridding and rarefaction), calculating a selection of standard biodiversity metrics (e.g. species richness, numerical abundance and exponential Shannon index) per year, alongside examples on how to calculate and plot linear trends of biodiversity change over time.</p>
<p>Note that each study in BioTIME is identified by a unique Study_ID and that all the functions in BioTIMEr assume that the variables are named as in the BioTIME data.</p>
<section class="level4"><h4 id="load-the-required-libraries">
<strong>Load the required libraries</strong><a class="anchor" aria-label="anchor" href="#load-the-required-libraries"></a>
</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install and load the latest version of BioTIMEr</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://biotimehub.github.io/BioTIMEr/">BioTIMEr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<p>When loading the BioTIMEr package, a subset of BioTIME data is loaded together with its metadata. This subset includes 12 studies from marine, terrestrial and freshwater time series across different taxonomic groups. The whole BioTIME database is accessible <a href="https://biotime.st-andrews.ac.uk/" class="external-link">here.</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># you can run the following commands to retrieve more information about the subsets.</span></span>
<span><span class="op">?</span><span class="va">BTsubset_meta</span></span>
<span><span class="op">?</span><span class="va">BTsubset_data</span></span></code></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># you can also see a full list of BioTIMEr functions and help pages by:</span></span>
<span><span class="op">?</span><span class="op">?</span><span class="va">BioTIMEr</span></span></code></pre></div>
</div>
</section><section class="level3"><h3 id="how-to-use-biotimer">How to use BioTIMEr?<a class="anchor" aria-label="anchor" href="#how-to-use-biotimer"></a>
</h3>
<ol type="1">
<li>Grid BioTIME data into a discrete global grid based on the samples’ location (latitude/longitude) to standardize the spatial extent between different studies using:
<ul>
<li><code><a href="../reference/gridding.html">gridding()</a></code></li>
</ul>
</li>
<li>Apply sample-based rarefaction to standardize the number of samples per year within each cell-level time series using:
<ul>
<li><code><a href="../reference/resampling.html">resampling()</a></code></li>
</ul>
</li>
<li>Calculate a set of standard alpha and/or beta diversity metrics using:
<ul>
<li><code><a href="../reference/getAlphaMetrics.html">getAlphaMetrics()</a></code></li>
<li><code><a href="../reference/getBetaMetrics.html">getBetaMetrics()</a></code></li>
</ul>
</li>
<li>Fit linear regression models to step 3 outputs as a function of time with:
<ul>
<li><code><a href="../reference/getLinearRegressions.html">getLinearRegressions ()</a></code></li>
</ul>
</li>
<li>Visualise the results.</li>
</ol>
<p>Below is a detailed run through these different steps, breaking down some of the tasks and the reasoning behind our suggestions for best practice when analysing BioTIME data.</p>
<p>We use the ‘pipe’ operator <code>(|&gt;)</code> to make our code more efficient and streamlined, and we use ggplot2 library for most visualisations. This and other libraries required for BioTIMEr to run will be, if needed, installed at the same time BioTIMEr is installed.</p>
<hr></section><section class="level3"><h3 id="why-bother-with-separating-observations-using-a-global-grid">Why bother with separating observations using a global grid?<a class="anchor" aria-label="anchor" href="#why-bother-with-separating-observations-using-a-global-grid"></a>
</h3>
<p>Typically, a BioTIME study contains distinct samples collected with a consistent methodology for a given period of time. However, the spatial extent and sample distribution among studies can vary substantially depending on the study and the taxon being sampled (e.g. forest quadrants, bird transects, fish tows, etc.; which can be implemented within smaller or larger areas). Because the spatial extent varies among studies, an advisable step is to grid those studies that have large extents and multiple sampling locations into smaller equal-sized subsets. The <code><a href="../reference/gridding.html">gridding()</a></code> function is designed to perform such task using a global grid of hexagonal cells derived from dggridR (see <code>vignette(‘dggridR’)</code>). By implementing this gridding, the large scales studies are split into multiple cell-level assemblages, while the small scale studies are assigned to a single cell.</p>
<p>Let’s apply <code><a href="../reference/gridding.html">gridding()</a></code> to a subset of BioTIME data and see what happens:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid_samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gridding.html">gridding</a></span><span class="op">(</span></span>
<span>  meta <span class="op">=</span> <span class="va">BTsubset_meta</span>,</span>
<span>  btf <span class="op">=</span> <span class="va">BTsubset_data</span>,</span>
<span>  res <span class="op">=</span> <span class="fl">12</span>,</span>
<span>  resByData <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get a look at the output</span></span>
<span><span class="va">grid_samples</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">kable</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div id="tbl-gridding_ex1" class="cell quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-tbl"><div aria-describedby="tbl-gridding_ex1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment">
<colgroup>
<col style="width: 2%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 5%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 11%">
<col style="width: 2%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 2%">
<col style="width: 2%">
<col style="width: 1%">
<col style="width: 13%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 3%">
<col style="width: 5%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">STUDY_ID</th>
<th style="text-align: left;">CLIMATE</th>
<th style="text-align: left;">REALM</th>
<th style="text-align: left;">TAXA</th>
<th style="text-align: left;">StudyMethod</th>
<th style="text-align: left;">ABUNDANCE_TYPE</th>
<th style="text-align: left;">BIOMASS_TYPE</th>
<th style="text-align: left;">SAMPLE_DESC</th>
<th style="text-align: left;">taxon</th>
<th style="text-align: right;">LATITUDE</th>
<th style="text-align: right;">LONGITUDE</th>
<th style="text-align: right;">YEAR</th>
<th style="text-align: right;">MONTH</th>
<th style="text-align: right;">DAY</th>
<th style="text-align: left;">Species</th>
<th style="text-align: left;">resolution</th>
<th style="text-align: right;">ABUNDANCE</th>
<th style="text-align: right;">BIOMASS</th>
<th style="text-align: right;">cell</th>
<th style="text-align: left;">assemblageID</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">10330</td>
<td style="text-align: right;">211</td>
<td style="text-align: left;">Temperate</td>
<td style="text-align: left;">Marine</td>
<td style="text-align: left;">Fish</td>
<td style="text-align: left;">ML</td>
<td style="text-align: left;">Count</td>
<td style="text-align: left;">Weight</td>
<td style="text-align: left;">31.67_-80.31_1980_5_15_28</td>
<td style="text-align: left;">Fish</td>
<td style="text-align: right;">31.67</td>
<td style="text-align: right;">-80.31</td>
<td style="text-align: right;">1980</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">15</td>
<td style="text-align: left;">Acanthostracion quadricornis</td>
<td style="text-align: left;">species</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.600</td>
<td style="text-align: right;">529239</td>
<td style="text-align: left;">211_529239</td>
</tr>
<tr class="even">
<td style="text-align: left;">10331</td>
<td style="text-align: right;">211</td>
<td style="text-align: left;">Temperate</td>
<td style="text-align: left;">Marine</td>
<td style="text-align: left;">Fish</td>
<td style="text-align: left;">ML</td>
<td style="text-align: left;">Count</td>
<td style="text-align: left;">Weight</td>
<td style="text-align: left;">31.67_-80.31_1980_5_15_28</td>
<td style="text-align: left;">Fish</td>
<td style="text-align: right;">31.67</td>
<td style="text-align: right;">-80.31</td>
<td style="text-align: right;">1980</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">15</td>
<td style="text-align: left;">Aluterus schoepfii</td>
<td style="text-align: left;">species</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.600</td>
<td style="text-align: right;">529239</td>
<td style="text-align: left;">211_529239</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10332</td>
<td style="text-align: right;">211</td>
<td style="text-align: left;">Temperate</td>
<td style="text-align: left;">Marine</td>
<td style="text-align: left;">Fish</td>
<td style="text-align: left;">ML</td>
<td style="text-align: left;">Count</td>
<td style="text-align: left;">Weight</td>
<td style="text-align: left;">31.67_-80.31_1980_5_15_28</td>
<td style="text-align: left;">Fish</td>
<td style="text-align: right;">31.67</td>
<td style="text-align: right;">-80.31</td>
<td style="text-align: right;">1980</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">15</td>
<td style="text-align: left;">Apogon pseudomaculatus</td>
<td style="text-align: left;">species</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.002</td>
<td style="text-align: right;">529239</td>
<td style="text-align: left;">211_529239</td>
</tr>
<tr class="even">
<td style="text-align: left;">10333</td>
<td style="text-align: right;">211</td>
<td style="text-align: left;">Temperate</td>
<td style="text-align: left;">Marine</td>
<td style="text-align: left;">Fish</td>
<td style="text-align: left;">ML</td>
<td style="text-align: left;">Count</td>
<td style="text-align: left;">Weight</td>
<td style="text-align: left;">31.67_-80.31_1980_5_15_28</td>
<td style="text-align: left;">Fish</td>
<td style="text-align: right;">31.67</td>
<td style="text-align: right;">-80.31</td>
<td style="text-align: right;">1980</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">15</td>
<td style="text-align: left;">Calamus leucosteus</td>
<td style="text-align: left;">species</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4.850</td>
<td style="text-align: right;">529239</td>
<td style="text-align: left;">211_529239</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10334</td>
<td style="text-align: right;">211</td>
<td style="text-align: left;">Temperate</td>
<td style="text-align: left;">Marine</td>
<td style="text-align: left;">Fish</td>
<td style="text-align: left;">ML</td>
<td style="text-align: left;">Count</td>
<td style="text-align: left;">Weight</td>
<td style="text-align: left;">31.67_-80.31_1980_5_15_28</td>
<td style="text-align: left;">Fish</td>
<td style="text-align: right;">31.67</td>
<td style="text-align: right;">-80.31</td>
<td style="text-align: right;">1980</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">15</td>
<td style="text-align: left;">Carapus bermudensis</td>
<td style="text-align: left;">species</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.008</td>
<td style="text-align: right;">529239</td>
<td style="text-align: left;">211_529239</td>
</tr>
<tr class="even">
<td style="text-align: left;">10335</td>
<td style="text-align: right;">211</td>
<td style="text-align: left;">Temperate</td>
<td style="text-align: left;">Marine</td>
<td style="text-align: left;">Fish</td>
<td style="text-align: left;">ML</td>
<td style="text-align: left;">Count</td>
<td style="text-align: left;">Weight</td>
<td style="text-align: left;">31.67_-80.31_1980_5_15_28</td>
<td style="text-align: left;">Fish</td>
<td style="text-align: right;">31.67</td>
<td style="text-align: right;">-80.31</td>
<td style="text-align: right;">1980</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">15</td>
<td style="text-align: left;">Centropristis ocyurus</td>
<td style="text-align: left;">species</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.026</td>
<td style="text-align: right;">529239</td>
<td style="text-align: left;">211_529239</td>
</tr>
</tbody>
</table>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl quarto-uncaptioned" id="tbl-gridding_ex1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table 1
</figcaption></figure>
</div>
</div>
<p>You can see that each sample is assigned a different combination of study ID and grid cell (based on its latitude and longitude) resulting in a unique identifier that determines our assemblage time series (<code>assemblageID</code>). This <code>assemblageID</code> can now be used as the study unit for analysis of biodiversity change based on similar spatial extent between them.</p>
<p>Let’s take a look and see how many studies/cells/assemblages time series are there in this subset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_res_1</span> <span class="op">&lt;-</span> <span class="va">grid_samples</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span></span>
<span>    n_cell <span class="op">=</span> <span class="fu">n_distinct</span><span class="op">(</span><span class="va">cell</span><span class="op">)</span>,</span>
<span>    n_aID <span class="op">=</span> <span class="fu">n_distinct</span><span class="op">(</span><span class="va">assemblageID</span><span class="op">)</span>,</span>
<span>    res <span class="op">=</span> <span class="st">"res12"</span>,</span>
<span>    .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">STUDY_ID</span>, <span class="va">StudyMethod</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">check_res_1</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">kable</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div id="tbl-gridding_ex2" class="cell quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-tbl"><div aria-describedby="tbl-gridding_ex2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment">
<thead><tr class="header">
<th style="text-align: right;">STUDY_ID</th>
<th style="text-align: left;">StudyMethod</th>
<th style="text-align: right;">n_cell</th>
<th style="text-align: right;">n_aID</th>
<th style="text-align: left;">res</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">211</td>
<td style="text-align: left;">ML</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">12</td>
<td style="text-align: left;">res12</td>
</tr>
<tr class="even">
<td style="text-align: right;">372</td>
<td style="text-align: left;">ML</td>
<td style="text-align: right;">85</td>
<td style="text-align: right;">85</td>
<td style="text-align: left;">res12</td>
</tr>
<tr class="odd">
<td style="text-align: right;">402</td>
<td style="text-align: left;">ML</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">res12</td>
</tr>
<tr class="even">
<td style="text-align: right;">431</td>
<td style="text-align: left;">ML</td>
<td style="text-align: right;">456</td>
<td style="text-align: right;">456</td>
<td style="text-align: left;">res12</td>
</tr>
<tr class="odd">
<td style="text-align: right;">437</td>
<td style="text-align: left;">ML</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">10</td>
<td style="text-align: left;">res12</td>
</tr>
<tr class="even">
<td style="text-align: right;">466</td>
<td style="text-align: left;">ML</td>
<td style="text-align: right;">250</td>
<td style="text-align: right;">250</td>
<td style="text-align: left;">res12</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: left;">SL</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">res12</td>
</tr>
<tr class="even">
<td style="text-align: right;">18</td>
<td style="text-align: left;">SL</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">res12</td>
</tr>
<tr class="odd">
<td style="text-align: right;">41</td>
<td style="text-align: left;">SL</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">res12</td>
</tr>
<tr class="even">
<td style="text-align: right;">53</td>
<td style="text-align: left;">SL</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">res12</td>
</tr>
</tbody>
</table>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl quarto-uncaptioned" id="tbl-gridding_ex2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table 2
</figcaption></figure>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># How many samples were there in each study?</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">check_res_1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">STUDY_ID</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">n_aID</span>, fill <span class="op">=</span> <span class="va">res</span><span class="op">)</span>,</span>
<span>    stat <span class="op">=</span> <span class="st">"identity"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_discrete</span><span class="op">(</span>type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#155f49"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"StudyID"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Number of assemblages in a study"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div id="fig-gridding_ex" class="quarto-float quarto-figure quarto-figure-center" width="672">
<figure class="quarto-float quarto-float-fig"><div aria-describedby="fig-gridding_ex-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="introduction_files/figure-html/fig-gridding_ex-1.png" id="fig-gridding_ex" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-gridding_ex-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 1
</figcaption></figure>
</div>
</div>
</div>
<p>You can see that several studies are not partitioned, and that’s because all their observations were already contained within a single cell.</p>
<section class="level4"><h4 id="what-happens-if-i-change-res">
<strong>What happens if I change <code>res</code>?</strong><a class="anchor" aria-label="anchor" href="#what-happens-if-i-change-res"></a>
</h4>
<p>By default, the function separates studies into hexagonal cells of ~96 km2 (<code>res=12</code>), as this resolution was found to be the most appropriate when working on the whole BioTIME database. Yet sometimes, particularly when working with a subset of BioTIME, you may want to explore alternative grid resolutions. The function has two options: you can either directly define a new resolution (see <code>vignette(‘dggridR’)</code>) or allow the function to find the best resolution based on the average study extent of your dataset. Let’s run over these alternative options with a few examples:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define an alternative resolution of 14 (~10.7 km2 cells)</span></span>
<span><span class="va">grid_samples_14</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gridding.html">gridding</a></span><span class="op">(</span></span>
<span>  meta <span class="op">=</span> <span class="va">BTsubset_meta</span>,</span>
<span>  btf <span class="op">=</span> <span class="va">BTsubset_data</span>,</span>
<span>  res <span class="op">=</span> <span class="fl">14</span>,</span>
<span>  resByData <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># allow the spatial extent of the data to define the resolution</span></span>
<span><span class="va">grid_samples_auto</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gridding.html">gridding</a></span><span class="op">(</span></span>
<span>  meta <span class="op">=</span> <span class="va">BTsubset_meta</span>,</span>
<span>  btf <span class="op">=</span> <span class="va">BTsubset_data</span>,</span>
<span>  res <span class="op">=</span> <span class="fl">12</span>,</span>
<span>  resByData <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># this option also returns a message with the automatically picked resolution:</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Resolution: 15, Area (km^2): 3.55473501726709, Spacing (km): 1.86210705534755, CLS (km): 2.12744663988395</code></pre>
</div>
</div>
<p>So what changed with different <code>res</code> values?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_res_2</span> <span class="op">&lt;-</span> <span class="va">grid_samples_14</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span></span>
<span>    n_cell <span class="op">=</span> <span class="fu">n_distinct</span><span class="op">(</span><span class="va">cell</span><span class="op">)</span>,</span>
<span>    n_aID <span class="op">=</span> <span class="fu">n_distinct</span><span class="op">(</span><span class="va">assemblageID</span><span class="op">)</span>,</span>
<span>    res <span class="op">=</span> <span class="st">"res14"</span>,</span>
<span>    .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">StudyMethod</span>, <span class="va">STUDY_ID</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">check_res_3</span> <span class="op">&lt;-</span> <span class="va">grid_samples_auto</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span></span>
<span>    n_cell <span class="op">=</span> <span class="fu">n_distinct</span><span class="op">(</span><span class="va">cell</span><span class="op">)</span>,</span>
<span>    n_aID <span class="op">=</span> <span class="fu">n_distinct</span><span class="op">(</span><span class="va">assemblageID</span><span class="op">)</span>,</span>
<span>    res <span class="op">=</span> <span class="st">"res15"</span>,</span>
<span>    .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">StudyMethod</span>, <span class="va">STUDY_ID</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">checks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">check_res_1</span>, <span class="va">check_res_2</span>, <span class="va">check_res_3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">checks</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span></span>
<span>    mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">STUDY_ID</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">n_aID</span>, fill <span class="op">=</span> <span class="va">res</span><span class="op">)</span>,</span>
<span>    stat <span class="op">=</span> <span class="st">"identity"</span>,</span>
<span>    position <span class="op">=</span> <span class="st">"dodge"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_discrete</span><span class="op">(</span>type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#155f49"</span>, <span class="st">"#66c1d1"</span>, <span class="st">"#d9d956"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"StudyID"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Number of assemblages in a study"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div id="fig-gridding_ex3" class="quarto-float quarto-figure quarto-figure-center" width="672">
<figure class="quarto-float quarto-float-fig"><div aria-describedby="fig-gridding_ex3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="introduction_files/figure-html/fig-gridding_ex3-1.png" id="fig-gridding_ex3" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-gridding_ex3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 2
</figcaption></figure>
</div>
</div>
</div>
<p>The number of cells in each study varies depending on the resolution chosen.</p>
<p>You can also map what happens when gridding the data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## The following example is built on the demonstrations in</span></span>
<span><span class="co">## https://cran.r-project.org/web/packages/dggridR/vignettes/dggridR.html.</span></span>
<span></span>
<span><span class="co"># First we build the ~96 km2 global grid</span></span>
<span><span class="va">dgg_12</span> <span class="op">&lt;-</span> <span class="fu">dggridR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dggridR/man/dgconstruct.html" class="external-link">dgconstruct</a></span><span class="op">(</span>res <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># To simplify, we only map the grid cell boundaries for cells which</span></span>
<span><span class="co"># have observations.</span></span>
<span><span class="co"># NOTE: if you are working with the full BioTIME database, this step may take some time.</span></span>
<span><span class="va">grid_12</span> <span class="op">&lt;-</span> <span class="fu">dggridR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dggridR/man/dgcellstogrid.html" class="external-link">dgcellstogrid</a></span><span class="op">(</span><span class="va">dgg_12</span>, <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">grid_samples</span><span class="op">$</span><span class="va">cell</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now let's follow the same steps and build a ~10.7 km2 global grid:</span></span>
<span><span class="va">dgg_14</span> <span class="op">&lt;-</span> <span class="fu">dggridR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dggridR/man/dgconstruct.html" class="external-link">dgconstruct</a></span><span class="op">(</span>res <span class="op">=</span> <span class="fl">14</span><span class="op">)</span></span>
<span><span class="va">grid_14</span> <span class="op">&lt;-</span> <span class="fu">dggridR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dggridR/man/dgcellstogrid.html" class="external-link">dgcellstogrid</a></span><span class="op">(</span><span class="va">dgg_14</span>, <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">grid_samples_14</span><span class="op">$</span><span class="va">cell</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># And we get some polygons for each country of the world, to create a background:</span></span>
<span><span class="va">countries</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/map_data.html" class="external-link">map_data</a></span><span class="op">(</span><span class="st">"world"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now you could map the whole world, but let's just zoom in the UK and have a look at</span></span>
<span><span class="co"># STUDY 466 (Marine Fish):</span></span>
<span><span class="va">map_uk_locations</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_polygon</span><span class="op">(</span>data <span class="op">=</span> <span class="va">countries</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">grid_12</span>, <span class="fu">aes</span><span class="op">(</span><span class="op">)</span>, color <span class="op">=</span> <span class="fu">alpha</span><span class="op">(</span><span class="st">"blue"</span>, <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>, <span class="fl">10</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">60</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_rect</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>xmin <span class="op">=</span> <span class="op">-</span><span class="fl">11</span>, xmax <span class="op">=</span> <span class="op">-</span><span class="fl">0.7</span>, ymin <span class="op">=</span> <span class="fl">57.2</span>, ymax <span class="op">=</span> <span class="fl">59</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"red"</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme</span><span class="op">(</span>text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">zoom_in_map</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_polygon</span><span class="op">(</span>data <span class="op">=</span> <span class="va">countries</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>               color <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">grid_12</span>, <span class="fu">aes</span><span class="op">(</span><span class="op">)</span>, color <span class="op">=</span> <span class="fu">alpha</span><span class="op">(</span><span class="st">"blue"</span>, <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">grid_14</span>, <span class="fu">aes</span><span class="op">(</span><span class="op">)</span>, color <span class="op">=</span> <span class="fu">alpha</span><span class="op">(</span><span class="st">"red"</span>, <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_sf</span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">11</span>, <span class="op">-</span><span class="fl">0.7</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">57.2</span>, <span class="fl">59</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/grid.newpage.html" class="external-link">grid.newpage</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">main</span> <span class="op">&lt;-</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/viewport.html" class="external-link">viewport</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1</span>, height <span class="op">=</span> <span class="fl">1</span>, x <span class="op">=</span> <span class="fl">0.5</span>, y <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>  <span class="co"># the main map</span></span>
<span><span class="va">inset</span> <span class="op">&lt;-</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/viewport.html" class="external-link">viewport</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.4</span>, height <span class="op">=</span> <span class="fl">0.4</span>, x <span class="op">=</span> <span class="fl">0.82</span>, y <span class="op">=</span> <span class="fl">0.45</span><span class="op">)</span>  <span class="co"># the inset in bottom left</span></span>
<span></span>
<span><span class="co"># The resulting distribution of different size cells appears as follows:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">zoom_in_map</span>, vp <span class="op">=</span> <span class="va">main</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">map_uk_locations</span>, vp <span class="op">=</span> <span class="va">inset</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div id="fig-gridding_map" class="quarto-float quarto-figure quarto-figure-center" width="672">
<figure class="quarto-float quarto-float-fig"><div aria-describedby="fig-gridding_map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="introduction_files/figure-html/fig-gridding_map-1.png" id="fig-gridding_map" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-gridding_map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 3
</figcaption></figure>
</div>
</div>
</div>
<p>We can see that the higher the resolution set the higher the number of cells into which samples get assigned. There is thus the risk of the resulting assemblages time series becoming too small to have any ecological meaning. A good rule of thumb is to never set <code>res</code> higher than the resolution you get when <code>resByData = TRUE</code>.</p>
</section></section><section class="level3"><h3 id="why-rarefaction-is-a-must">Why rarefaction is a must!<a class="anchor" aria-label="anchor" href="#why-rarefaction-is-a-must"></a>
</h3>
<p>Now we will deal with another common issue when working with time series data: the fact that the number of samples may vary over time. When evaluating changes through time it’s important to be able to quantify change independently of the number of samples, i.e. we want to be able to assess whether e.g. alpha diversity has truly increased or decreased over time and that such signal is not a sampling artifact due to uneven sampling effort – i.e. resulting from having more or fewer samples in different years or periods of the time series being compared.</p>
<p>Probably the most common and widely used approach to prevent temporal variation in sampling effort from affecting diversity estimate is to apply sample-based rarefaction. Here (add link) is a great introduction to it. BioTIMEr provides the <code><a href="../reference/resampling.html">resampling()</a></code> function that implements sample-based rarefaction, already adapted to BioTIME data and designed to run smoothly over the previously gridded dataset as done above. The function identifies the minimum number of samples across all years in a time series and then uses this minimum to randomly resample each year down to that number.</p>
<p>Let’s continue with our BioTIME example subset dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First, if you are not sure you need this step,</span></span>
<span><span class="co"># you can always check how many samples there are in every year of the different time series:</span></span>
<span><span class="va">check_samples</span> <span class="op">&lt;-</span> <span class="va">grid_samples</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span></span>
<span>    n_samples <span class="op">=</span> <span class="fu">n_distinct</span><span class="op">(</span><span class="va">SAMPLE_DESC</span><span class="op">)</span>,</span>
<span>    n_species <span class="op">=</span> <span class="fu">n_distinct</span><span class="op">(</span><span class="va">Species</span><span class="op">)</span>,</span>
<span>    .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">STUDY_ID</span>, <span class="va">assemblageID</span>, <span class="va">YEAR</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">check_samples</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">kable</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div id="tbl-resampling_ex" class="cell quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-tbl"><div aria-describedby="tbl-resampling_ex-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment">
<thead><tr class="header">
<th style="text-align: right;">STUDY_ID</th>
<th style="text-align: left;">assemblageID</th>
<th style="text-align: right;">YEAR</th>
<th style="text-align: right;">n_samples</th>
<th style="text-align: right;">n_species</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">211</td>
<td style="text-align: left;">211_529239</td>
<td style="text-align: right;">1980</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">30</td>
</tr>
<tr class="even">
<td style="text-align: right;">211</td>
<td style="text-align: left;">211_529240</td>
<td style="text-align: right;">1980</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">47</td>
</tr>
<tr class="odd">
<td style="text-align: right;">211</td>
<td style="text-align: left;">211_525598</td>
<td style="text-align: right;">1980</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">38</td>
</tr>
<tr class="even">
<td style="text-align: right;">211</td>
<td style="text-align: left;">211_521960</td>
<td style="text-align: right;">1980</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">54</td>
</tr>
<tr class="odd">
<td style="text-align: right;">211</td>
<td style="text-align: left;">211_523410</td>
<td style="text-align: right;">1980</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">24</td>
</tr>
<tr class="even">
<td style="text-align: right;">211</td>
<td style="text-align: left;">211_517585</td>
<td style="text-align: right;">1980</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">42</td>
</tr>
<tr class="odd">
<td style="text-align: right;">211</td>
<td style="text-align: left;">211_523410</td>
<td style="text-align: right;">1981</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">23</td>
</tr>
<tr class="even">
<td style="text-align: right;">211</td>
<td style="text-align: left;">211_525598</td>
<td style="text-align: right;">1981</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">31</td>
</tr>
<tr class="odd">
<td style="text-align: right;">211</td>
<td style="text-align: left;">211_521960</td>
<td style="text-align: right;">1981</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">36</td>
</tr>
<tr class="even">
<td style="text-align: right;">211</td>
<td style="text-align: left;">211_517585</td>
<td style="text-align: right;">1981</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">20</td>
</tr>
</tbody>
</table>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl quarto-uncaptioned" id="tbl-resampling_ex-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table 3
</figcaption></figure>
</div>
</div>
<p>Looking at the <code>n_samples</code> column we can already see for the few assemblages in this subset that there are substantial differences in sampling effort (i.e. number of samples) through time. Thus, we should standardize for sampling effort:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Let's apply resampling() then, using the data frame of the gridded data:</span></span>
<span><span class="va">grid_rare</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/resampling.html">resampling</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">grid_samples</span>,</span>
<span>  measure <span class="op">=</span> <span class="st">"ABUNDANCE"</span>,</span>
<span>  resamps <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  conservative <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<p>The function returns a single long-form data frame containing the total currency of interest (i.e. summed across all samples) for each species in each year within each assemblage time series. You can specify what the currency field is: Abundance, Biomass or both (BioTIME studies can include records for either or both). Note that resampling() also tests and removes any <code>NAs</code> within the selected currency field(s) before implementing the sample-based rarefaction. Thus, if you choose to use both currency fields, only observations (when <code>conservative = FALSE</code>) or full sampling events (when <code>conservative = TRUE</code>) in which BOTH Abundance and Biomass were recorded are retained and a warning is issued as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Keep only observations with both abundance and biomass</span></span>
<span><span class="va">grid_rare_ab</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/resampling.html">resampling</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">grid_samples</span>,</span>
<span>  measure <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ABUNDANCE"</span>, <span class="st">"BIOMASS"</span><span class="op">)</span>,</span>
<span>  resamps <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  conservative <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Keep only sampling events where all observations within had both abundance and biomass to start with</span></span>
<span><span class="va">grid_rare_abT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/resampling.html">resampling</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">grid_samples</span>,</span>
<span>  measure <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ABUNDANCE"</span>, <span class="st">"BIOMASS"</span><span class="op">)</span>,</span>
<span>  resamps <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  conservative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<section class="level4"><h4 id="how-many-resampling-iterations-should-we-implement">
<strong>How many resampling iterations should we implement?</strong><a class="anchor" aria-label="anchor" href="#how-many-resampling-iterations-should-we-implement"></a>
</h4>
<p>Remember that sample-based rarefaction involves randomly selecting a specified number of samples (i.e. sampling events) for each year, this number being equal to the number of samples in the year with the lowest sampling effort in each time series. If the sampling effort through time was equal or relatively stable, then you probably do not need to concern yourself any further. However, for many time series in BioTIME (or indeed other biodiversity data) sampling effort can vary substantially, and thus the sample-based rarefaction process can lead to different species diversity and composition simply by randomly selecting different samples. To help exemplify this point across, let’s pick one assemblage time series from the subset and plot the number of samples recorded in each year:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># What is the number of samples in the year with the lowest sampling effort?</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">check_samples</span><span class="op">[</span><span class="va">check_samples</span><span class="op">$</span><span class="va">assemblageID</span> <span class="op">==</span> <span class="st">"18_335699"</span>,<span class="op">]</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">YEAR</span>, y <span class="op">=</span> <span class="va">n_samples</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">YEAR</span>, y <span class="op">=</span> <span class="va">n_samples</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"red"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_segment</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1926</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">n_samples</span><span class="op">)</span> <span class="op">+</span> <span class="fl">3</span>,</span>
<span>                   xend <span class="op">=</span> <span class="fl">1927</span>, yend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">n_samples</span><span class="op">)</span><span class="op">)</span>,</span>
<span>               arrow <span class="op">=</span> <span class="fu">arrow</span><span class="op">(</span>length <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fl">0.2</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"Year"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylab</span><span class="op">(</span><span class="st">"Number of samples"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># In this case,the year 1927 had the lowest sampling effort, with 3 samples (arrow).</span></span></code></pre></div>
<div class="cell-output-display">
<div id="fig-resampling_ex3" class="quarto-float quarto-figure quarto-figure-center" width="672">
<figure class="quarto-float quarto-float-fig"><div aria-describedby="fig-resampling_ex3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="introduction_files/figure-html/fig-resampling_ex3-1.png" id="fig-resampling_ex3" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-resampling_ex3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 4
</figcaption></figure>
</div>
</div>
</div>
<p>In this particular case, what <code><a href="../reference/resampling.html">resampling()</a></code>will do is to randomly select and retain only 3 samples from each year of this time series. As you can see in the plot, several years have 20 samples or more; so if you run the function a second time it’s likely that the sample-based rarefaction process will select a different combination of 3 samples (with the exception of year 1927), which may or may not differ in their species diversity and composition.</p>
<p>One option to deal with this issue is to repeat this random sampling process multiple times, effectively creating multiple alternative datasets for the same time series (and which can be used in subsequent sensitivity analysis or to estimate the variability in diversity metrics that originates from the random sample selection process):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Let's implement the sample-based rarefaction by resampling the dataset 10 times.</span></span>
<span><span class="va">grid_rare_n10</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/resampling.html">resampling</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">grid_samples</span>,</span>
<span>  measure <span class="op">=</span> <span class="st">"ABUNDANCE"</span>,</span>
<span>  resamps <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  conservative <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Note that you may want to resample many more times (e.g. at least 30-100+ times, but up to 199</span></span>
<span><span class="co"># if e.g. working with the whole BioTIME data), depending on how many iterations you want a</span></span>
<span><span class="co"># subsequent bootstrap analysis to have.</span></span>
<span><span class="co"># This may also take some computation time, so if you are working with a big subset of BioTIME</span></span>
<span><span class="co"># is advisable to break it down in smaller subsets.</span></span>
<span></span>
<span><span class="co"># Each resampling iteration will be identified as resamp = 1:n, in this case 1:10.</span></span>
<span><span class="co"># Now we can check if there are differences across the first 3 of these iterations:</span></span>
<span></span>
<span><span class="va">check_resamps</span> <span class="op">&lt;-</span> <span class="va">grid_rare_n10</span><span class="op">[</span><span class="va">grid_rare_n10</span><span class="op">$</span><span class="va">resamp</span> <span class="op">&lt;</span> <span class="fl">4</span>, <span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span></span>
<span>    n_obs <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    n_species <span class="op">=</span> <span class="fu">n_distinct</span><span class="op">(</span><span class="va">Species</span><span class="op">)</span>,</span>
<span>    n_year <span class="op">=</span> <span class="fu">n_distinct</span><span class="op">(</span><span class="va">YEAR</span><span class="op">)</span>,</span>
<span>    .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">STUDY_ID</span>, <span class="va">assemblageID</span>, <span class="va">resamp</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">check_resamps</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">kable</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div id="tbl-resampling_ex4" class="cell quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-tbl"><div aria-describedby="tbl-resampling_ex4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment">
<thead><tr class="header">
<th style="text-align: right;">STUDY_ID</th>
<th style="text-align: left;">assemblageID</th>
<th style="text-align: right;">resamp</th>
<th style="text-align: right;">n_obs</th>
<th style="text-align: right;">n_species</th>
<th style="text-align: right;">n_year</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: left;">10_359170</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">61</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">18</td>
<td style="text-align: left;">18_335699</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">728</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">29</td>
</tr>
<tr class="odd">
<td style="text-align: right;">211</td>
<td style="text-align: left;">211_504467</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">211</td>
<td style="text-align: left;">211_505197</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">211</td>
<td style="text-align: left;">211_515398</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">211</td>
<td style="text-align: left;">211_516855</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">36</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: right;">211</td>
<td style="text-align: left;">211_517585</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: right;">211</td>
<td style="text-align: left;">211_521960</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">145</td>
<td style="text-align: right;">58</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="odd">
<td style="text-align: right;">211</td>
<td style="text-align: left;">211_523410</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="even">
<td style="text-align: right;">211</td>
<td style="text-align: left;">211_525598</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">118</td>
<td style="text-align: right;">48</td>
<td style="text-align: right;">7</td>
</tr>
</tbody>
</table>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl quarto-uncaptioned" id="tbl-resampling_ex4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table 4
</figcaption></figure>
</div>
</div>
<p>Since sampling events within a study are retrieved with a consistent methodology and observational effort, we don’t expect to see big differences between picking some sampling events over others, however it’s still an advisable check to do. The example above also highlights the fact that during the process of standardising the number of samples per year within each time series, a lot of data will be discarded. Additional steps, such as removing low sampling years, before applying the <code><a href="../reference/resampling.html">resampling()</a></code> function may minimize this effect.</p>
<p><strong>Your data is now ready for analysis!</strong> You can stop here and go do your own thing (the world is your oyster!)…or you can follow the next steps and learn how to use the BioTIMEr package to estimate a few standard diversity metrics, as well as some hints on how to quantify and visualize temporal biodiversity change for a given BioTIME data subset.</p>
<p>Please note that as BioTIMEr is designed to interact with BioTIME data, the functions are built using BioTIME variable names. However the functions and workflow we describe can be easily applied to any time series data as long as the variable names are modified accordingly before.</p>
</section></section><section class="level3"><h3 id="calculate-diversity-estimates">Calculate diversity estimates<a class="anchor" aria-label="anchor" href="#calculate-diversity-estimates"></a>
</h3>
<p>Now the following functions are pretty straightforward. <code><a href="../reference/getAlphaMetrics.html">getAlphaMetrics()</a></code> and <code><a href="../reference/getBetaMetrics.html">getBetaMetrics()</a></code> estimate a set of common alpha and beta diversity metrics for each year within each time series in your BioTIME data. Let’s apply them to our now processed BioTIME example dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get alpha metrics estimates:</span></span>
<span><span class="va">alpha_metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getAlphaMetrics.html">getAlphaMetrics</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">grid_rare</span>, measure <span class="op">=</span> <span class="st">"ABUNDANCE"</span><span class="op">)</span></span>
<span><span class="co"># see also help("getAlphaMetrics") for more details on the metrics</span></span>
<span></span>
<span><span class="co"># Have a quick look at the output</span></span>
<span><span class="va">alpha_metrics</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">kable</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<table class="table">
<colgroup>
<col style="width: 7%">
<col style="width: 13%">
<col style="width: 5%">
<col style="width: 3%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 11%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 11%">
</colgroup>
<thead><tr class="header">
<th style="text-align: right;">resamp</th>
<th style="text-align: left;">assemblageID</th>
<th style="text-align: right;">YEAR</th>
<th style="text-align: right;">S</th>
<th style="text-align: right;">N</th>
<th style="text-align: right;">maxN</th>
<th style="text-align: right;">Shannon</th>
<th style="text-align: right;">Simpson</th>
<th style="text-align: right;">invSimpson</th>
<th style="text-align: right;">PIE</th>
<th style="text-align: right;">DomMc</th>
<th style="text-align: right;">expShannon</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">10_359170</td>
<td style="text-align: right;">1984</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">3427</td>
<td style="text-align: right;">1863</td>
<td style="text-align: right;">1.557755</td>
<td style="text-align: right;">0.6598196</td>
<td style="text-align: right;">2.939616</td>
<td style="text-align: right;">0.6600122</td>
<td style="text-align: right;">0.6798950</td>
<td style="text-align: right;">4.748150</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">10_359170</td>
<td style="text-align: right;">1992</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">2029</td>
<td style="text-align: right;">920</td>
<td style="text-align: right;">1.760637</td>
<td style="text-align: right;">0.7347483</td>
<td style="text-align: right;">3.770004</td>
<td style="text-align: right;">0.7351106</td>
<td style="text-align: right;">0.6106456</td>
<td style="text-align: right;">5.816141</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">10_359170</td>
<td style="text-align: right;">1996</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">2220</td>
<td style="text-align: right;">1153</td>
<td style="text-align: right;">1.659082</td>
<td style="text-align: right;">0.6868517</td>
<td style="text-align: right;">3.193375</td>
<td style="text-align: right;">0.6871612</td>
<td style="text-align: right;">0.6698198</td>
<td style="text-align: right;">5.254485</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">18_335699</td>
<td style="text-align: right;">1923</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">317</td>
<td style="text-align: right;">103</td>
<td style="text-align: right;">2.403741</td>
<td style="text-align: right;">0.8529889</td>
<td style="text-align: right;">6.802207</td>
<td style="text-align: right;">0.8556882</td>
<td style="text-align: right;">0.4574132</td>
<td style="text-align: right;">11.064495</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">18_335699</td>
<td style="text-align: right;">1926</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">335</td>
<td style="text-align: right;">95</td>
<td style="text-align: right;">2.542344</td>
<td style="text-align: right;">0.8771129</td>
<td style="text-align: right;">8.137553</td>
<td style="text-align: right;">0.8797390</td>
<td style="text-align: right;">0.3970149</td>
<td style="text-align: right;">12.709431</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">18_335699</td>
<td style="text-align: right;">1927</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">279</td>
<td style="text-align: right;">137</td>
<td style="text-align: right;">2.021259</td>
<td style="text-align: right;">0.7338292</td>
<td style="text-align: right;">3.756986</td>
<td style="text-align: right;">0.7364689</td>
<td style="text-align: right;">0.5913978</td>
<td style="text-align: right;">7.547824</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get beta metrics estimates:</span></span>
<span><span class="va">beta_metrics</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getBetaMetrics.html">getBetaMetrics</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">grid_rare</span>, measure <span class="op">=</span> <span class="st">"ABUNDANCE"</span><span class="op">)</span></span>
<span><span class="co">#see also help("getBetaMetrics") for more details on the metrics</span></span>
<span></span>
<span><span class="co"># Have a quick look at the output</span></span>
<span><span class="va">beta_metrics</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">kable</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<table style="width:100%;" class="table">
<colgroup>
<col style="width: 10%">
<col style="width: 18%">
<col style="width: 7%">
<col style="width: 17%">
<col style="width: 24%">
<col style="width: 21%">
</colgroup>
<thead><tr class="header">
<th style="text-align: right;">resamp</th>
<th style="text-align: left;">assemblageID</th>
<th style="text-align: right;">YEAR</th>
<th style="text-align: right;">JaccardDiss</th>
<th style="text-align: right;">MorisitaHornDiss</th>
<th style="text-align: right;">BrayCurtisDiss</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">10_359170</td>
<td style="text-align: right;">1984</td>
<td style="text-align: right;">0.0500000</td>
<td style="text-align: right;">0.0175351</td>
<td style="text-align: right;">0.2727273</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">10_359170</td>
<td style="text-align: right;">1992</td>
<td style="text-align: right;">0.3043478</td>
<td style="text-align: right;">0.0078712</td>
<td style="text-align: right;">0.2672215</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">10_359170</td>
<td style="text-align: right;">1996</td>
<td style="text-align: right;">0.2608696</td>
<td style="text-align: right;">0.0209460</td>
<td style="text-align: right;">0.1452106</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">18_335699</td>
<td style="text-align: right;">1923</td>
<td style="text-align: right;">0.3333333</td>
<td style="text-align: right;">0.0953127</td>
<td style="text-align: right;">0.2546012</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">18_335699</td>
<td style="text-align: right;">1926</td>
<td style="text-align: right;">0.4074074</td>
<td style="text-align: right;">0.1143048</td>
<td style="text-align: right;">0.3389262</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">18_335699</td>
<td style="text-align: right;">1927</td>
<td style="text-align: right;">0.4838710</td>
<td style="text-align: right;">0.0878927</td>
<td style="text-align: right;">0.3568406</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># NOTE the functions used the rarefied data with only one resampling iteration</span></span></code></pre></div>
</div>
<p>There are many metrics for measuring biodiversity in community ecology. Here, we focused on the more commonly used metrics when measuring temporal changes in biodiversity. getAlphaMetrics() estimates nine alpha diversity metrics: Species richness (<code>S</code>), numerical abundance (<code>N</code>), maximum numerical abundance (<code>maxN</code>), Shannon index, Simpson index, inverse Simpson, McNaughton dominance, probability of intraspecific encounter (<code>PIE</code>) and exponential Shannon. getBetaMetrics() estimates three beta diversity metrics: Jaccard dissimilarity, Bray-Curtis dissimilarity and Morisita-Horn dissimilarity, assuming the first year in the time series as the baseline. Note that <code>N</code> and <code>maxN</code> metrics return numerical abundance when <code>measure=ABUNDANCE</code>, and biomass values when <code>measure=BIOMASS</code>.</p>
</section><section class="level3"><h3 id="investigating-biodiversity-trends">Investigating biodiversity trends<a class="anchor" aria-label="anchor" href="#investigating-biodiversity-trends"></a>
</h3>
<p>Finally, when looking to measure biodiversity change using temporal data, it is common to estimate temporal trends in alpha diversity and beta diversity by fitting a simple linear regression to the diversity estimates over the duration of the time series. The <code><a href="../reference/getLinearRegressions.html">getLinearRegressions()</a></code> function implements linear models as a function of year and is designed to run smoothly over an output of either the <code><a href="../reference/getAlphaMetrics.html">getAlphaMetrics()</a></code> or <code><a href="../reference/getBetaMetrics.html">getBetaMetrics()</a></code> functions. Specifically, it provides the results of simple linear regressions (slope, p-value, significance, intercept) using lm(), and fit individually to the yearly diversity estimates of each metric within each assemblage time series in your dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Let's apply it then:</span></span>
<span><span class="va">alpha_slopes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getLinearRegressions.html">getLinearRegressions</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">alpha_metrics</span>,</span>
<span>  pThreshold <span class="op">=</span> <span class="fl">0.05</span></span>
<span><span class="op">)</span> <span class="co">#for alpha metrics</span></span>
<span></span>
<span><span class="co"># Have a quick look at the output</span></span>
<span><span class="va">alpha_slopes</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">kable</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div id="tbl-trends1" class="cell quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-tbl"><div aria-describedby="tbl-trends1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment">
<colgroup>
<col style="width: 18%">
<col style="width: 11%">
<col style="width: 18%">
<col style="width: 14%">
<col style="width: 18%">
<col style="width: 19%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">assemblageID</th>
<th style="text-align: left;">metric</th>
<th style="text-align: right;">slope</th>
<th style="text-align: right;">pvalue</th>
<th style="text-align: right;">significance</th>
<th style="text-align: right;">intercept</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">10_359170</td>
<td style="text-align: left;">resamp</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1.000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">10_359170</td>
<td style="text-align: left;">S</td>
<td style="text-align: right;">0.0892857</td>
<td style="text-align: right;">0.2122956</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">-158.071429</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10_359170</td>
<td style="text-align: left;">N</td>
<td style="text-align: right;">-111.1785714</td>
<td style="text-align: right;">0.2927126</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">223878.142857</td>
</tr>
<tr class="even">
<td style="text-align: left;">10_359170</td>
<td style="text-align: left;">maxN</td>
<td style="text-align: right;">-67.5535714</td>
<td style="text-align: right;">0.3647395</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">135788.642857</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10_359170</td>
<td style="text-align: left;">Shannon</td>
<td style="text-align: right;">0.0108605</td>
<td style="text-align: right;">0.5460426</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">-19.960516</td>
</tr>
<tr class="even">
<td style="text-align: left;">10_359170</td>
<td style="text-align: left;">Simpson</td>
<td style="text-align: right;">0.0032689</td>
<td style="text-align: right;">0.6471082</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">-5.813447</td>
</tr>
</tbody>
</table>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl quarto-uncaptioned" id="tbl-trends1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table 5
</figcaption></figure>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Let's apply it then:</span></span>
<span><span class="va">beta_slopes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getLinearRegressions.html">getLinearRegressions</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">beta_metrics</span>,</span>
<span>  pThreshold <span class="op">=</span> <span class="fl">0.05</span></span>
<span><span class="op">)</span> <span class="co">#for beta metrics</span></span>
<span></span>
<span><span class="co"># Have a quick look at the output</span></span>
<span><span class="va">beta_slopes</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">kable</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div id="tbl-trends2" class="cell quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-tbl"><div aria-describedby="tbl-trends2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment">
<colgroup>
<col style="width: 17%">
<col style="width: 22%">
<col style="width: 14%">
<col style="width: 13%">
<col style="width: 17%">
<col style="width: 15%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">assemblageID</th>
<th style="text-align: left;">metric</th>
<th style="text-align: right;">slope</th>
<th style="text-align: right;">pvalue</th>
<th style="text-align: right;">significance</th>
<th style="text-align: right;">intercept</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">10_359170</td>
<td style="text-align: left;">resamp</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">NaN</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">1.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">10_359170</td>
<td style="text-align: left;">JaccardDiss</td>
<td style="text-align: right;">0.0196040</td>
<td style="text-align: right;">0.3144615</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">-38.8200311</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10_359170</td>
<td style="text-align: left;">MorisitaHornDiss</td>
<td style="text-align: right;">0.0000711</td>
<td style="text-align: right;">0.9592150</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">-0.1260088</td>
</tr>
<tr class="even">
<td style="text-align: left;">10_359170</td>
<td style="text-align: left;">BrayCurtisDiss</td>
<td style="text-align: right;">-0.0092066</td>
<td style="text-align: right;">0.4300531</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">18.5557534</td>
</tr>
<tr class="odd">
<td style="text-align: left;">18_335699</td>
<td style="text-align: left;">resamp</td>
<td style="text-align: right;">0.0000000</td>
<td style="text-align: right;">0.0580340</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.0000000</td>
</tr>
<tr class="even">
<td style="text-align: left;">18_335699</td>
<td style="text-align: left;">JaccardDiss</td>
<td style="text-align: right;">0.0009753</td>
<td style="text-align: right;">0.5726912</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">-1.2950025</td>
</tr>
</tbody>
</table>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl quarto-uncaptioned" id="tbl-trends2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table 6
</figcaption></figure>
</div>
</div>
<p>You can change the default P-value threshold for statistical significance (i.e. the measure of the strength of evidence against <code>H0</code>). For easy sorting, plotting and interpretation, a column called <code>significance</code> is also provided, where 1 indicates the threshold is met, i.e. the estimated slope is significant at the specified p-value level.</p>
<p>Also note that some biodiversity analysis may benefit from additional transformations and scaling of data before modelling (check a nice tutorial on the subject <a href="https://ourcodingclub.github.io/tutorials/data-scaling/" class="external-link">here</a>).</p>
</section><section class="level3"><h3 id="summarize-and-visualize-biodiversity-trends">Summarize and visualize biodiversity trends<a class="anchor" aria-label="anchor" href="#summarize-and-visualize-biodiversity-trends"></a>
</h3>
<p>Now that we have quantified change through time, we are ready to make some plots! The next section provides only a few examples of queries and data visualization, but it’s not a comprehensive exploration of the results, which will also vary depending on your own research question.</p>
<p>Right, let’s start will some overall summaries and trends:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First, how many assemblages in our dataset show a moderate evidence (P &lt; 0.05) of change in alpha diversity?</span></span>
<span><span class="va">alpha_slopes</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">significance</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span>   <span class="co"># or use filter(pvalue&lt;0.05)</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>n_sig <span class="op">=</span> <span class="fu">n_distinct</span><span class="op">(</span><span class="va">assemblageID</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">slope</span><span class="op">)</span>, .by <span class="op">=</span> <span class="va">metric</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">kable</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># We can see that only a few (&lt;40) of the assemblage time series actually show a significant</span></span>
<span><span class="co"># trend of change over time, independently of the metric used. This indicates that in most</span></span>
<span><span class="co"># time series in the studies we analysed alpha diversity is not really changing through time.</span></span></code></pre></div>
<div id="tbl-trends3" class="cell quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-tbl"><div aria-describedby="tbl-trends3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table do-not-create-environment">
<thead><tr class="header">
<th style="text-align: left;">metric</th>
<th style="text-align: right;">n_sig</th>
<th style="text-align: right;">mean(slope)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Simpson</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">0.0115106</td>
</tr>
<tr class="even">
<td style="text-align: left;">invSimpson</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">0.1542588</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PIE</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">0.0099448</td>
</tr>
<tr class="even">
<td style="text-align: left;">DomMc</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">-0.0076345</td>
</tr>
<tr class="odd">
<td style="text-align: left;">maxN</td>
<td style="text-align: right;">28</td>
<td style="text-align: right;">14.7363484</td>
</tr>
<tr class="even">
<td style="text-align: left;">Shannon</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">0.0025595</td>
</tr>
<tr class="odd">
<td style="text-align: left;">N</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">-64.6258799</td>
</tr>
<tr class="even">
<td style="text-align: left;">expShannon</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">-0.1047391</td>
</tr>
<tr class="odd">
<td style="text-align: left;">S</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">-0.1621397</td>
</tr>
<tr class="even">
<td style="text-align: left;">resamp</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">0.0000000</td>
</tr>
</tbody>
</table>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-tbl quarto-uncaptioned" id="tbl-trends3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table 7
</figcaption></figure>
</div>
</div>
<p>Let’s do some summary plots showing the variation of alpha diversity change:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get a slope per assemblageID and metric</span></span>
<span><span class="va">alpha_slopes_simp</span> <span class="op">&lt;-</span> <span class="va">alpha_slopes</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">significance</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co">#select only the assemblages with significant trends</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">slope</span><span class="op">)</span>, .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">assemblageID</span>, <span class="va">metric</span>, <span class="va">pvalue</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the mean slope and CIs</span></span>
<span><span class="va">stats_alpha</span> <span class="op">&lt;-</span> <span class="va">alpha_slopes_simp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span></span>
<span>    mean_slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">slope</span><span class="op">)</span>, <span class="co">#mean</span></span>
<span>    ci_slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">qt</a></span><span class="op">(</span><span class="fl">0.95</span>, df <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">slope</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span></span>
<span>      <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">slope</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">slope</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    .by <span class="op">=</span> <span class="va">metric</span></span>
<span>  <span class="op">)</span> <span class="co">#margin of error</span></span>
<span></span>
<span><span class="co"># Let's put it all together</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">alpha_slopes_simp</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">slope</span>, fill <span class="op">=</span> <span class="va">metric</span><span class="op">)</span>, bins <span class="op">=</span> <span class="fl">25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#geom_density(alpha=0.5)+ #in case you want a density plot instead</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span></span>
<span>    <span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    linetype <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"grey"</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> <span class="co">#add slope=0 line</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">stats_alpha</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">mean_slope</span><span class="op">)</span>,</span>
<span>    linetype <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"black"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> <span class="co">#mean</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">stats_alpha</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">mean_slope</span> <span class="op">-</span> <span class="va">ci_slope</span><span class="op">)</span>,</span>
<span>    linetype <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"black"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> <span class="co">#lower confidence interval</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">stats_alpha</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">mean_slope</span> <span class="op">+</span> <span class="va">ci_slope</span><span class="op">)</span>,</span>
<span>    linetype <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"black"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> <span class="co">#upper confidence interval</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">metric</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/BioTIME-palette.html">scale_fill_biotime</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="co">#using the customize BioTIME colour scale. See help("scale_color_biotime") for more options.</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Alpha diversity change"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>    plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">11</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div id="fig-trends" class="quarto-float quarto-figure quarto-figure-center" width="691.2">
<figure class="quarto-float quarto-float-fig"><div aria-describedby="fig-trends-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="introduction_files/figure-html/fig-trends-1.png" id="fig-trends" width="691">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-trends-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 5
</figcaption></figure>
</div>
</div>
</div>
<p>Now the same for beta diversity change:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get a slope per assemblageID and metric</span></span>
<span><span class="va">beta_slopes_simp</span> <span class="op">&lt;-</span> <span class="va">beta_slopes</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">significance</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="co">#select only the assemblages with significant trends</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span>slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">slope</span><span class="op">)</span>, .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">assemblageID</span>, <span class="va">metric</span>, <span class="va">pvalue</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the mean slope and CIs</span></span>
<span><span class="va">stats_beta</span> <span class="op">&lt;-</span> <span class="va">beta_slopes_simp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span></span>
<span>    mean_slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">slope</span><span class="op">)</span>, <span class="co">#mean</span></span>
<span>    ci_slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">qt</a></span><span class="op">(</span><span class="fl">0.95</span>, df <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">slope</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span></span>
<span>      <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">slope</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">slope</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    .by <span class="op">=</span> <span class="va">metric</span></span>
<span>  <span class="op">)</span> <span class="co">#margin of error</span></span>
<span></span>
<span><span class="co"># Let's put it all together</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">beta_slopes_simp</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">slope</span>, fill <span class="op">=</span> <span class="va">metric</span><span class="op">)</span>, bins <span class="op">=</span> <span class="fl">25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">#geom_density(alpha=0.5)+ #in case you want a density plot instead</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span></span>
<span>    <span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    linetype <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"grey"</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> <span class="co">#add slope=0 line</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">stats_beta</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">mean_slope</span><span class="op">)</span>,</span>
<span>    linetype <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"black"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> <span class="co">#mean</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">stats_beta</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">mean_slope</span> <span class="op">-</span> <span class="va">ci_slope</span><span class="op">)</span>,</span>
<span>    linetype <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"black"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> <span class="co">#lower confidence interval</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">stats_beta</span>,</span>
<span>    <span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">mean_slope</span> <span class="op">+</span> <span class="va">ci_slope</span><span class="op">)</span>,</span>
<span>    linetype <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"black"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> <span class="co">#upper confidence interval</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">metric</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/BioTIME-palette.html">scale_fill_biotime</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="co">#using the customize BioTIME colour scale. See help("scale_color_biotime") for more options.</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Beta diversity change"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>    plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">11</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div id="fig-trends2" class="quarto-float quarto-figure quarto-figure-center" width="691.2">
<figure class="quarto-float quarto-float-fig"><div aria-describedby="fig-trends2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="introduction_files/figure-html/fig-trends2-1.png" id="fig-trends2" width="691">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-trends2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 6
</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Hint: If you wish to plot all metrics together, simply merge you alpha_slopes and</span></span>
<span><span class="co"># beta_slopes dataframes beforehand.</span></span></code></pre></div>
</div>
<p>That’s great! While overall trends are important, you may also want to evaluate the patterns for a specific taxa or climate, and look at both sets of trends (i.e. significant and non-significant) together. For example, let’s say you want to have a look at changes in Shannon diversity for the two more represented taxon in our example BioTIME dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First, we need to check the meta file and retrieve the information for the studies of interest</span></span>
<span><span class="co">#head(BTsubset_meta)</span></span>
<span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="fu">select</span><span class="op">(</span><span class="va">BTsubset_meta</span>, <span class="va">STUDY_ID</span>, <span class="va">TAXA</span>, <span class="va">REALM</span>, <span class="va">CLIMATE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get a slope per assemblageID and metric</span></span>
<span><span class="va">alpha_slopes_simp</span> <span class="op">&lt;-</span> <span class="va">alpha_slopes</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarise</span><span class="op">(</span></span>
<span>    slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">slope</span><span class="op">)</span>,</span>
<span>    .by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">assemblageID</span>, <span class="va">metric</span>, <span class="va">pvalue</span>, <span class="va">significance</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Get back the Study ID by separating our assemblageID column into multiple other columns.</span></span>
<span><span class="va">alpha_slopes_simp</span> <span class="op">&lt;-</span> <span class="va">alpha_slopes_simp</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">separate_wider_delim</span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="va">assemblageID</span>,</span>
<span>    names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"STUDY_ID"</span>, <span class="st">"cell"</span><span class="op">)</span>,</span>
<span>    delim <span class="op">=</span> <span class="st">"_"</span>,</span>
<span>    cols_remove <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Merge it all</span></span>
<span><span class="va">alpha_slopes_meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">alpha_slopes_simp</span>, <span class="va">meta</span>, by <span class="op">=</span> <span class="st">"STUDY_ID"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Select relevant data for plotting</span></span>
<span><span class="va">alpha_slopes_set1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span></span>
<span>  <span class="va">alpha_slopes_meta</span>,</span>
<span>  <span class="va">alpha_slopes_meta</span><span class="op">$</span><span class="va">metric</span> <span class="op">==</span> <span class="st">"Shannon"</span> <span class="op">&amp;</span></span>
<span>    <span class="op">(</span><span class="va">alpha_slopes_meta</span><span class="op">$</span><span class="va">TAXA</span> <span class="op">==</span> <span class="st">"Fish"</span> <span class="op">|</span> <span class="va">alpha_slopes_meta</span><span class="op">$</span><span class="va">TAXA</span> <span class="op">==</span> <span class="st">"Birds"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Let's put it all together</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">alpha_slopes_set1</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">slope</span>, fill <span class="op">=</span> <span class="va">TAXA</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"grey"</span>, bins <span class="op">=</span> <span class="fl">25</span><span class="op">)</span> <span class="op">+</span> <span class="co">#all assemblages</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">alpha_slopes_set1</span><span class="op">[</span><span class="va">alpha_slopes_set1</span><span class="op">$</span><span class="va">significance</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span>,</span>
<span>    bins <span class="op">=</span> <span class="fl">25</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> <span class="co">#only significant change assemblages</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span></span>
<span>    <span class="fu">aes</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    linetype <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    colour <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> <span class="co">#add slope=0 line</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">TAXA</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/BioTIME-palette.html">scale_fill_biotime</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Shannon-Weiner Species Diversity Index"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">11</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div id="fig-trends6" class="quarto-float quarto-figure quarto-figure-center" width="691.2">
<figure class="quarto-float quarto-float-fig"><div aria-describedby="fig-trends6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="introduction_files/figure-html/fig-trends6-1.png" id="fig-trends6" width="691">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-trends6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 7
</figcaption></figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Now we see the full distribution of slopes of change for the Shannon index for the birds</span></span>
<span><span class="co"># and fish time series in our subset: all slopes are shown in grey, while in color we show</span></span>
<span><span class="co"># the subset of assemblages for which evidence (P &lt; 0.05) of change was detected.</span></span></code></pre></div>
</div>
<p>We might also want to explore the different trends for a given time series, allowing us to visualise the data and the trend line:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Let's go back to the data frame with the yearly values and select our relevant data for plotting</span></span>
<span><span class="va">alpha_metrics_set</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">alpha_metrics</span>, <span class="va">assemblageID</span> <span class="op">==</span> <span class="st">"18_335699"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Transform data</span></span>
<span><span class="va">alpha_metrics_set_long</span> <span class="op">&lt;-</span> <span class="fu">pivot_longer</span><span class="op">(</span><span class="va">alpha_metrics_set</span>,</span>
<span>                                   cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="st">"N"</span>, <span class="st">"maxN"</span>, <span class="st">"Shannon"</span>, <span class="st">"expShannon"</span>,</span>
<span>                                   <span class="st">"Simpson"</span>, <span class="st">"invSimpson"</span>, <span class="st">"PIE"</span>, <span class="st">"DomMc"</span><span class="op">)</span>,</span>
<span>                                   names_to <span class="op">=</span> <span class="st">"metric"</span>,</span>
<span>                                   names_transform <span class="op">=</span> <span class="va">as.factor</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get assemblage ID slope of change</span></span>
<span><span class="va">alpha_slopes_set2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">alpha_slopes</span>, <span class="va">assemblageID</span> <span class="op">==</span> <span class="st">"18_335699"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Get assemblage ID</span></span>
<span><span class="va">name_assemblage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">alpha_slopes_set2</span><span class="op">$</span><span class="va">assemblageID</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Merge info</span></span>
<span><span class="va">alpha_metr_slop</span><span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">alpha_slopes_set2</span>,</span>
<span>  y <span class="op">=</span> <span class="va">alpha_metrics_set_long</span>,</span>
<span>  by <span class="op">=</span> <span class="fu">join_by</span><span class="op">(</span><span class="va">assemblageID</span>, <span class="va">metric</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Let's put it all together</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">alpha_metr_slop</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">YEAR</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">geom_point</span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"#155f49"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>   <span class="co">#plot the yearly estimates</span></span>
<span>    <span class="fu">stat_smooth</span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, linetype <span class="op">=</span> <span class="fl">2</span>, colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span> <span class="co">#draw all regression line</span></span>
<span>    <span class="fu">stat_smooth</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">alpha_metr_slop</span>, <span class="va">alpha_metr_slop</span><span class="op">$</span><span class="va">significance</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">YEAR</span>, y <span class="op">=</span> <span class="va">value</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                linetype <span class="op">=</span> <span class="fl">2</span>, colour <span class="op">=</span> <span class="st">"#155f49"</span><span class="op">)</span> <span class="op">+</span> <span class="co">#color only trends that are significant</span></span>
<span>    <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span><span class="va">metric</span>, scales <span class="op">=</span> <span class="st">"free"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/BioTIME-palette.html">scale_fill_biotime</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">ggtitle</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Assemblage"</span>, <span class="va">name_assemblage</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"Diversity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">theme</span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">11</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div id="fig-trends8" class="quarto-float quarto-figure quarto-figure-center" width="691.2">
<figure class="quarto-float quarto-float-fig"><div aria-describedby="fig-trends8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="introduction_files/figure-html/fig-trends8-1.png" id="fig-trends8" width="691">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-trends8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure 8
</figcaption></figure>
</div>
</div>
</div>
<p>We can see that results vary depending on the dataset and the metric of change used. It is important to remember that biodiversity metrics are just a tool used to measure changes, and each have diverse abilities to detect changes in different biodiversity dimensions and under different scenarios e.g.They thus provide different pieces of a complex puzzle and may strongly affect our interpretation of biodiversity change.</p>
</section><section class="level3"><h3 id="credits-and-disclaimer">Credits and Disclaimer<a class="anchor" aria-label="anchor" href="#credits-and-disclaimer"></a>
</h3>
<p>This R package was developed by the BioTIME team. The functions and documentation were developed predominantly by Alban Sagouis, Faye Moyes and Inês S. Martins. For optimal use, the package should operate in the manner described here. Feedback is appreciated, particularly if you come across any errors or would like to suggest changes. Updates will be made sporadically.</p>
</section><section class="level3"><h3 id="how-to-cite-biotimer">How to cite BioTIMEr<a class="anchor" aria-label="anchor" href="#how-to-cite-biotimer"></a>
</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/citation.html" class="external-link">citation</a></span><span class="op">(</span><span class="st">"BioTIMEr"</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>To cite package 'BioTIMEr' in publications use:

  Sagouis A, Moyes F, Martins IS, Blowes SA, Brambilla V, Chow CFY,
  Fontrodona-Eslava A, Antão L, Chase JM, Dornelas M, Magurran AE
  (2024). _BioTIMEr: tools to use and explore the BioTIME database_.
  doi:10.32614/CRAN.package.BioTIMEr
  &lt;https://doi.org/10.32614/CRAN.package.BioTIMEr&gt;,
  &lt;https://github.com/bioTIMEHub/BioTIMEr&gt;.

A BibTeX entry for LaTeX users is

  @Manual{,
    title = {BioTIMEr: tools to use and explore the BioTIME database},
    author = {Alban Sagouis and Faye Moyes and Inês S. Martins and Shane A. Blowes and Viviana Brambilla and Cher F. Y. Chow and Ada Fontrodona-Eslava and Laura Antão and Jonathan M. Chase and Maria Dornelas and Anne E. Magurran},
    year = {2024},
    url = {https://github.com/bioTIMEHub/BioTIMEr},
    doi = {10.32614/CRAN.package.BioTIMEr},
  }</code></pre>
</div>
</div>
</section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://albansagouis.com" class="external-link">Alban Sagouis</a>, Faye Moyes, Inês S. Martins, Jonathan M. Chase, Maria Dornelas, Anne E. Magurran, European Research Council grant AdG BioTIME 250189, European Research Council grant PoC BioCHANGE 727440, European Research Council grant AdG MetaCHANGE 101098020, The Leverhulme Centre for Anthropocene Biodiversity grant RC-2018-021, German Centre for Integrative Biodiversity Research (iDiv) Halle-Jena-Leipzig, Martin Luther University Halle-Wittenberg, University of St Andrews.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
